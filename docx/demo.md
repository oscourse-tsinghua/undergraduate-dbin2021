# 基于树状区块链的地图信息存储和展现

## 引言

## 课题背景

## 相关调研

### 区块链与智能合约
区块链是一种新型的那联网应用模式,它具备分布式、去中心化、集体维护、共识机制的特点，目前广泛应用于不同领域中。区块链，具体来说，是一个共享的不可更改的总账，它用于记录交易、跟踪资产以及建立信任。这些资产可以是有形的(房屋，汽车，现金，土地等)或者无形的(知识产权，专利，版权，品牌等)。几乎所有有价值的东西都可以在区块链网络上进行跟踪和交易，从而降低了风险并削减了所有相关人员的成本。交易业务依靠信息，收到的越快、越准确，就会越好。区块链是传递该信息的理想选择，因为它可以提供在不可更改的总账中的即时、共享且完全透明的信息，这类信息智能由获得许可的网络成员访问。另外，区块链网络也可以跟踪订单、付款、账户、生产等等。而且因为成员之间可以共享信息，所以成员可以查看到交易端到端的所有细节，从而带来更好的效率。
区块链有三个关键要素，分布式分类账技术、不可篡改以及智能合约。分布式分类账技术是指所有网络参与者都可以访问分布式分类账以及不可变的交易记录，且所有交易仅记录一次，从而消除传统业务网络中大量的重复工作和数据。不可篡改是指，区块链将交易记录到共享的分类账上后，任何网络参与者都无法更改或篡改该交易，如果交易中包含错误，则必须添加新交易来撤销该错误。
智能合约是存储在区块链上的程序，可以在满足预定条件的情况下运行，它们通常是自动执行的脚本，以便所有参与者无需任何中介机构的参与就可以立即结果，极大保证安全性。智能合约代码语句十分简单，当预定条件已经得到满足并完成验证时，区块链网络将执行对应动作，比如释放资金，发出凭证等，然后交易完成时更新区块链。由智能合约完成的交易也是无法更改的，只有获得许可的参与者才能看到结果。目前很多平台都实现了智能合约功能，使用的较多的还是以太坊上的智能合约。本文的课题也是基于以太坊来进行相关研究。
### 地理数据表示
随着移动用户的剧增，交互式信息地图服务需求正在逐渐增多，矢量数据地图正在兴起。在矢量地图数据中，矢量数据可以在所有放缩水平下以不同的颜色正确显示和区分特征，也正因如此使其正在快速发展。目前矢量地图主要利用`Web Map Tile Service(WMTS)`框架，它可以解决矢量数据分布不均和传输延迟长的问题，在此框架中，地图矢量数据需要被划分为图块，然后根据客户端的请求返回对应图块数据给客户端，通过它们各自的坐标在客户端重新组合，所以矢量数据的编码方式是影响其传输性能和可用性的关键因素。
XML和JSON是web应用程序中常用的两种矢量数据编码方法。`XML`(可扩展标记语言)是一种标记语言，用作Internet信息交换的标准。它具有良好的语义和可扩展性，并且可以灵活地表示数据，但由于XML使用重量级语法，因此会导致其格式复杂且大小较大，不利于上述地图数据传输。`JSON`是一种易于读写的轻量级数据表示格式，`GeoJson`是其中一种轻量级的数据表示方法，用于编码各类地理数据结构，可用于简单表示地理信息。
传统的矢量地图如`Google Maps`,采用二维数据经纬度来表示地理信息，这是一种球面坐标系统，当计算两点间距离时，要利用球面距离计算公式，涉及到复杂的三角函数，不便于计算。`Geohash`是一种新型的地址编码方式，它使用Base32编码成一维的字符串代替二维的经纬度数据。与`Google Maps`编码经纬度编码相比，`GeoHash`将二维空间查询转换为一维字符串匹配，利用此优势，`GeoHash`编码可以实现时间复杂度为`O(1)`快速查询。与Bing Maps相比，GeoHash编码使用Base32编码方法，同一前缀有32个不同子序列，而使用Base64的Bing Maps同一前缀下只有4个子序列。另外，基于GeoHash编码的空间索引算法具有对大量地理数据的高性能查询功能。当前，如Google Maps等主流地图产品采用经纬度表示地理数据坐标位置，而索引则采用另一种方法，GeoHash编码可以将二者结合起来，根据编码长度的不同，GeoHash可以同时表示图块的索引范围和坐标，从而可以实现统一编码。GeoHash编码同时给地理位置进行了分区，在位数较少时，它可以用来表示某一区域在地球上的坐标，在位数足够时，它也可以用来表示某个具体点在地球上的坐标。GeoHash在编码过程中保留了一定的相对地理位置信息，在大部分情况下，GeoHash编码共同前缀越长的区块物理距离越近。
### 车辆位置验证及信誉评估

### 车载自组网的区块链结构
传统区块链技术基于区块，整个网络同时只有一条单片，基于PoW共识机制出块无法并发执行，无法满足车载自组网对高并发操作和网络稳定性的需求，传统区块链也不具备移动性，无法与地理位置信息进行绑定，不能有效利用车载网中地理信息的区域化特性。另外，传统区块链的单链结构，要求所有节点必须在同一区块链中，这将会导致节点数目和数据量过大，不满足车载自组网中车辆节点的移动特性，且一旦出现网络分区，就会对整个区块链产生很大影响。目前采用分片技术更改原始单链的链式结构是解决上述问题的主流方法`[Global 2020]`
#### 多链结构
根据多链结构是否改变底层区块链结构可分为应用多链和结构多链。应用多链，即在应用层面建立不同功能的多个区块链，没有修改底层区块链结构。结构多链，即根据需求对区块链底层结构进行调整的多链结构。
##### 应用多链
`Zhang`等[Intelligent2017]提出了区块链群概念，即将区块链按照电力系统功能分为数据区块链、资产区块链、分析区块链、运营区块链以及支付区块链这5条独立运行的区块链。其中数据区块链为其他各个区块链提供文件服务结构，从分布式文件系统中读取所需数据，其他区块链的计算结果也可通过该接口写入数据区块链。
`[Regional2019]`研究了区域区块链在车载自组网中的应用，它是一个由物理边界区域内的节点共享的区块链。如果将区域区块链用于地理有限的区域，由于较小的传播延迟，可以极大减少到端到的消息延迟，提高区块链中节点交易效率，从理论上说，可以将整个区块链分为多个区域区块链，但该文仅从一个区域区块链内部进行了相关研究，并没有设计跨区域和跨链交易的相关内容。
[e-Health2019]提出了一种给予隐私保护的医疗保健系统，包含专用链和公用链两种区块链模型。专用链，即侧链，用于保存有关患者的真实身份信息；公用链，即主链，用于存储有关患者健康的信息以及标有临时ID的数据，从而实现了隐私数据保护和可用数据公开访问。通过特定节点掌握患者临时ID和真实身份的关联，来实现两个区块链数据的传递。
`[Ocha2020]`提出了一种使用侧链使智能电网具有可扩展性和适应性的区块链架构，将开放式智能电网协议`(OSGP)`集成三个区块链中，分别为`BlockPRI`、`BlockSEC`和`BlockTST`。其中，`BlockPRI`是用于存储每个用户的隐私，`BlockSEC`存储用户的数据，`BlockTST`管理和验证有关消费者-消费者和消费者-公司之间的能源贸易的信息。每个区块链对应一个功能，从整体上保证智能电网网络的隐私性和安全性。
##### 结构多链
结构多链是根据需求对区块链底层结构进行调整的多链结构，根据其组成特点，结构多链又可以分为并发多链和层次多链。并发多链结构扁平，各个子链可以根据需求负责相同或者不同的功能，相互之间地位平等。而层次多链属于多层级结构，至少具备上下层级关系的子链结构，各个层级负责的功能不同，地位也不同。
- 并发多链
## 基于`GeoHash`地图显示

### 简介

### `GeoHashTile`

### 小结

## 道路信息存储

### 原理

### 改进

### 小结

## 树状区块链测试

### 总体框架和运行环境

### `GeoHash`地图信息存储

### `GeoHashTile`前端显示

### 车辆位置验证

## 系统测试

### 实验数据

### 分析与改进方向

### 本章小结

## 结论
## 参考文献
[Regional2019]R. Shrestha and S. Y. Nam, "Regional Blockchain for Vehicular Networks to Prevent 51% Attacks," in IEEE Access, vol. 7, pp. 95033-95045, 2019

[Intelligent2017]Zhang J , Gao W Z , Zhang Y C , et al. Blockchain Based Intelligent Distributed Electrical Energy Systems: Needs, Concepts, Approaches and Vision[J]. Zidonghua Xuebao/acta Automatica Sinica, 2017, 43(9):1544-1554.

[e-Health2019]L. Hirtan, P. Krawiec, C. Dobre and J. M. Batalla, "Blockchain-Based Approach for e-Health Data Access Management with Privacy Protection," 2019 IEEE 24th International Workshop on Computer Aided Modeling and Design of Communication Links and Networks (CAMAD), Limassol, Cyprus, 2019, pp. 1-7.

[Ocha2020]Ocha I S , Silva L A , Mello G D , et al. A Cost Analysis of Implementing a Blockchain Architecture in a Smart Grid Scenario Using Sidechains[J]. Sensors (Basel, Switzerland), 2020, 20(3).

Keying Huang, G.L.; Wang, J. Rapid retrieval strategy for massive remote sensing metadata based on

GeoHash coding. Remote Sens. Lett. 2019, 10, 111–119. [CrossRef]

Liu, J.; Li, H.; Yong, G.; Hao, Y.; Dan, J. A geohash-based index for spatial data management in distributed memory. In Proceedings of the International Conference on Geoinformatics, Kaohsiung,

Taiwan, 25–27 June 2014

Zhang, J.; Yang, C.; Yang, Q.; Lin, Y.; Zhang, Y. HGeoHashBase: An optimized storage model of spatial

objects for location-based services. Front. Comput. Sci. China 2018, 14, 208–218. [CrossRef]